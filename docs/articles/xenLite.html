<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>xenLite: exploration of a class for Xenium demonstration data • xenLite</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="xenLite: exploration of a class for Xenium demonstration data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xenLite</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.19</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/xenLite.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vjcitn/xenLite/">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="xenLite_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>xenLite: exploration of a class for Xenium demonstration data</h1>
                        <h4 data-toc-skip class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 data-toc-skip class="date">September 11, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vjcitn/xenLite/blob/HEAD/vignettes/xenLite.Rmd"><code>vignettes/xenLite.Rmd</code></a></small>
      <div class="hidden name"><code>xenLite.Rmd</code></div>

    </div>

    
    
<style type="text/css">
blockquote {
    padding: 10px 20px;
    margin: 0 0 20px;
    font-size: 14px;
    border-left: 5px solid #eee;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h3>
<p>Numerous groups are working on methodology for analyzing new data resources emerging from spatial transcriptomics experiments. The “computing technology stack” necessary to work with such data is complex. The following <a href="https://spatialdata.scverse.org/en/latest/tutorials/notebooks/notebooks/examples/models1.html" class="external-link">comment</a> (Aug 16 2024) from the scverse group is characteristic:</p>
<blockquote>
<p>The SpatialData Zarr format, which is described in our design doc, is an extension of the OME-NGFF specification, which makes use of the OME-Zarr, the AnnData Zarr and the Parquet file formats. We need to use these combination of technologies because currently OME-NGFF does not provide all the fundamentals required for storing spatial omics dataset; nevertheless, we try to stay as close as OME-NGFF as possible, and we are contributing to ultimately make spatial omics support available in pure OME-NGFF.</p>
</blockquote>
<p>In Bioconductor 3.19, we might be committed to all these technologies (which include but do not mention HDF5) plus R, reticulate, basilisk, and sf to have a widely functional solution. Attaching the <a href="https://bioconductor.org/packages/Voyager" class="external-link">Voyager</a> package leads to loading over 100 associated packages. The xenLite package is intended to explore the balance between functionality and high dependency load specifically for the analysis of outputs from 10x Xenium experiments. The XenSPEP class extends <a href="https://bioconductor.org/packages/SpatialExperiment" class="external-link">SpatialExperiment</a> to include references to parquet files that manage voluminous geometry data; geometry can also be handled as DataFrame for sufficiently low volume experiments.</p>
<p>As of 0.0.7 of xenLite, a new class, XenSPEP, is provided to address parquet representation of cell, nucleus and transcript coordinates.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>This package is based on publicly available datasets.</p>
<ul>
<li><p><strong>Human dermal melanoma</strong> <a href="https://www.10xgenomics.com/datasets/xenium-prime-ffpe-human-skin" class="external-link">FFPE Human pan tissue dataset</a>. For this dataset, we retrieved the <code>outs.zip</code> file from this site and ran <code><a href="https://rdrr.io/pkg/XenSCE/man/ingest_xen.html" class="external-link">XenSCE::ingest_xen</a></code> on the contents, producing a XenSPEP instance which was then saved in an HDF5-backed representation. This, along with the parquet files for cell, nucleus, and transcript coordinates, are zipped together and placed in an Open Storage Network bucket for retrieval via <code>cache_xen_pdmel_lite</code>.</p></li>
<li><p><strong>Human prostate adenocarcinoma</strong> <a href="https://www.10xgenomics.com/datasets/xenium-prime-ffpe-human-prostate" class="external-link">FFPE Human pan tissue dataset</a>. For this dataset, we retrieved the <code>outs.zip</code> file from this site and ran <code><a href="https://rdrr.io/pkg/XenSCE/man/ingest_xen.html" class="external-link">XenSCE::ingest_xen</a></code> on the contents, producing a XenSPEP instance which was then saved in an HDF5-backed representation. This, along with the parquet files for cell, nucleus, and transcript coordinates, are zipped together and placed in an Open Storage Network bucket for retrieval via <code>cache_xen_prost_lite</code>.</p></li>
<li><p><strong>Human Lung</strong> <a href="https://www.10xgenomics.com/datasets/preview-data-ffpe-human-lung-cancer-with-xenium-multimodal-cell-segmentation-1-standard" class="external-link">FFPE Lung cancer preview</a>, Use <code>example(cache_xen_luad)</code> to obtain this instance of XenSPEP.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="a-quick-look">A quick look<a class="anchor" aria-label="anchor" href="#a-quick-look"></a>
</h3>
<div class="section level4">
<h4 id="hybrid-example">Hybrid example<a class="anchor" aria-label="anchor" href="#hybrid-example"></a>
</h4>
<p>In this example, transcript counts are in memory in a sparse matrix, but geometry information is handled in parquet. The <code>view_seg_g2</code> function allows selection of two gene symbols, and cells are colored according to single or double occupancy.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vjcitn/xenLite">xenLite</a></span><span class="op">)</span></span>
<span><span class="va">luad</span> <span class="op">=</span> <span class="fu"><a href="../reference/cache_xen_luad.html">cache_xen_luad</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pa</span> <span class="op">=</span> <span class="fu"><a href="../reference/cache_xen_luad.html">cache_xen_luad</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">luad</span> <span class="op">=</span> <span class="fu"><a href="../reference/restoreZipXenSPEP.html">restoreZipXenSPEP</a></span><span class="op">(</span><span class="va">pa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">luad</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html" class="external-link">make.names</a></span><span class="op">(</span><span class="fu">SummarizedExperiment</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">luad</span><span class="op">)</span><span class="op">$</span><span class="va">Symbol</span>, unique<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="../reference/view_seg_g2.html">view_seg_g2</a></span><span class="op">(</span><span class="va">luad</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5800</span>, <span class="fl">6300</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1300</span>, <span class="fl">1800</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">.5</span>, gene1<span class="op">=</span><span class="st">"CD4"</span>, gene2<span class="op">=</span><span class="st">"EPCAM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">5800</span>,<span class="fl">1390</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"cyan"</span>, <span class="st">"pink"</span><span class="op">)</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>, <span class="st">"EPCAM"</span>, <span class="st">"both"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="xenLite_files/figure-html/dolung-1.png" width="672"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span><span class="op">$</span><span class="va">ncells</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2074</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="interactivity">Interactivity<a class="anchor" aria-label="anchor" href="#interactivity"></a>
</h4>
<p>In <code>inst/app4</code>, code is provided to work with the primary dermal melanoma dataset. A map of the cell coordinates can drive focused exploration. The region of interest is shown by a whitened rectangle in the upper left corner.</p>
<div class="figure">
<img src="fblmap.png" alt="Map based on cell centroids." width="624"><p class="caption">
Map based on cell centroids.
</p>
</div>
<p>Cells are colored by quintile of size. Points where FBL transcripts are found are plotted as dots.</p>
<div class="figure">
<img src="FBLsketch.png" alt="Zoom to slider-specified subplot." width="624"><p class="caption">
Zoom to slider-specified subplot.
</p>
</div>
<p>More work is needed to identify useful exploratory visualizations.</p>
</div>
<div class="section level4">
<h4 id="large-disk-based-example">Large disk-based example<a class="anchor" aria-label="anchor" href="#large-disk-based-example"></a>
</h4>
<div class="section level5">
<h5 id="hdf5parquet-backed-example-not-ready-in-xenlite">HDF5+parquet-backed example: <em>not ready in xenLite</em><a class="anchor" aria-label="anchor" href="#hdf5parquet-backed-example-not-ready-in-xenlite"></a>
</h5>
<p>We want to be able to accommodate very large numbers of cells and transcripts without heavy infrastructure commitments.</p>
<p>We’ll use the prostate adenocarcinoma 5K dataset to demonstrate. A 900MB zip file will be cached.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prost</span> <span class="op">=</span> <span class="fu"><a href="../reference/cache_xen_prost_lite.html">cache_xen_prost_lite</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code>prost</code> is the path to a zip file in a BiocFileCache instance.</p>
<p>Create a folder to work in, and unzip.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">xpw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"prost_work"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="va">prost</span>, exdir<span class="op">=</span><span class="va">xpw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">xpw</span><span class="op">)</span></span></code></pre></div>
<p>Restore the SpatialExperiment component.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prostx</span> <span class="op">=</span> <span class="fu">HDF5Array</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HDF5Array/man/saveHDF5SummarizedExperiment.html" class="external-link">loadHDF5SummarizedExperiment</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">xpw</span>, <span class="st">"xen_prost"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prostx</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Vincent Carey.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
